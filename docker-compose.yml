services:
    node-installer:
        image: node:20.17.0
        volumes:
            - ./:/home/node/project
        environment:
            npm_config_cache: /home/node/cache
        working_dir: /home/node/project
        user: 1000:1000
        command: npm i

    vue:
        image: node:20.17.0
        volumes:
            - ./:/home/node/project
        environment:
            npm_config_cache: /home/node/cache
        working_dir: /home/node/project
        user: 1000:1000
        command: npm run dev:vue
        depends_on:
            node-installer:
                condition: service_completed_successfully

    nestjs:
        image: node:20.17.0
        volumes:
            - ./:/home/node/project
        ports:
            - 1506:1506
        environment:
            npm_config_cache: /home/node/cache
        working_dir: /home/node/project/
        user: 1000:1000
        command: npm run dev:nestjs
        depends_on:
            node-installer:
                condition: service_completed_successfully

    nginx:
        image: nginx
        volumes:
            - ./nginx.conf:/etc/nginx/conf.d/default.conf
        ports:
            - 80:80
        depends_on:
            - vue
            - nestjs
        attach: false
